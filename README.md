# ShibbyApp Server
This is the companion backend program for [ShibbyApp](https://github.com/kraowx/shibbyapp) responsible for collecting, organizing, and distributing Shibby's audio files.

## Installation
This is a console program so it must be run from the terminal. Download the latest version of the server [here](https://github.com/kraowx/shibbyapp-server/releases/latest). The program also requires *at least* Java 6 to run. If you don't have Java installed already, you can download the latest version [here](https://www.java.com/en/download/). Run the program by opening a terminal and entering ```java -jar <PATH_TO_YOUR_DOWNLOADED_FILE>```, where you should replace <PATH_TO_YOUR_DOWNLOADED_FILE> with the absolute path to the server file you downloaded. You can optionally specify a port for the server to run on by appending ```-p <PORT_NUMBER>``` to the previous command, where you should replace <PORT_NUMBER> with an actual number. You can also optionally specify an interval to wait between refreshing the data from soundgasm. To specify the interval to the server, append ```-i <INTERVAL_IN_MINUTES>``` to the original command, where you should <INTERVAL_IN_MINUTES> with an actual number. Note that the two previous commands *can* be combined. *If no port is specified the server will default to port 1967. If no interval is specified, the server will default to update every 24 hours.*

### Example
The following command will start a new server located at the local file "server.jar" on the port 2020 and update every 25 hours: ```java -jar server.jar -p 2020 -i 1500```

## Patreon Integration
This is an *optional* feature that enables the server to gather the latest files from Patreon. This feature is not enabled by default. Patreon requests to a server with this feature not enabled will result in an error.

*Disclaimer: This feature is **not** a way to bypass supporting Shibby on Patreon. A Patreon account with an active pledge to Shibby ($5 minimum tier for access to patron-only content) is required when requesting data from the server. An account is also required by the server host to set up this feature. Due to limitations imposed by Patreon, all accounts requesting data from the server will be restricted to the pledge tier of the server host's account, regardless of the tier of the user. Also, if the pledge tier of the host is higher than that of the user, the ShibbyApp client will not play any files that the user would not have access to.*

### Patreon Setup
To setup Patreon integration, you will need [Python3](https://www.python.org/downloads/) installed on your computer. You will also need to download the [Patreon script](https://github.com/kraowx/shibbyapp-server/releases/latest/download/patreonScript.py) which handles communication with Patreon. Move ```patreonScript.py``` to the same location as ```shibbyapp-server.jar```. Next, you will need to install a few dependencies in order for the script to work. Open a terminal and enter the command ```pip3 install requests cfscrape```. Press enter and wait for the installation to finish. Finally, you need to add your Patreon account to the server configuration. Simply run the server with the --config-patreon option: ```java -jar shibbyapp-server.jar --config-patreon``` and you will be prompted to enter the email and password for your Patreon account. This should create the file ```shibbyapp-server.config``` in the same location as the server executable containing your Patreon account info. The next time you run the server normally, the server will start gathering data from your Patreon feed.

## Series
Since it is difficult to detect which files are part of which series, they will have to be declared manually. I have already created a file that contains a few declarations. You can download that file [here](https://raw.githubusercontent.com/kraowx/shibbyapp-server/master/seriesList.json) and save it to a file named "seriesList.json". In order for the server to detect this file, it must be placed in the same directory/folder as the server executable.

### Series Structure
The series file uses the JSON format, where each series is a JSON object declared in the top level. A series JSON object uses the following structure: ```{name: string, fileCount: int, files: [file1, file2, ...]}```, where "name" (required) is the name of the series, "fileCount" (optional) is the number of files in the series, and "files" (required) is a JSON array of the file data for each file. Each file in the "files" JSON array uses the following structure: ```{name: string, id: string, shortName: string, link: string, tags: [tag1, tag2, ...], description: string}```, where "name" (required) is the name of the file, "id" (optional) is the unique base64 encoded ID created from the original file name (will be generated if omitted), "shortName" (optional) is the file name without the trailing tags (will be generated if omitted), "link" (required) is the direct link to the audio file, "tags" (optional) is a JSON array of strings that will be used *instead* of the tags detected in the file name, and "description" (optional) is the text that describes the contents of the file.

### Adding a Series
Adding a series is actually quite straightforward, and you can really just copy the format/pattern used in the ```seriesList.json``` file to create a new series. You will need to construct a JSON object for each file you want to add to the series by following the structure described above. Once you have the JSON objects for each file, you can construct a JSON object for the series and simply add it to the top-level JSON array.
